!function(t){var e={};function s(i){if(e[i])return e[i].exports;var h=e[i]={i:i,l:!1,exports:{}};return t[i].call(h.exports,h,h.exports,s),h.l=!0,h.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var h in t)s.d(i,h,function(e){return t[e]}.bind(null,h));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=0)}([function(e,s,i){"use strict";i.r(s);class h{constructor(t="none"){this.state=t}toString(){return String(state)}copy(){return new h(String(this.state))}setBlack(){this.state="black"}setWhite(){this.state="white"}setState(t){this.state=t}getState(){return String(this.state)}isBlack(){return"black"===this.state}isWhite(){return"white"===this.state}isNone(){return"none"===this.state}clear(){this.state="none"}static playerReverse(t){return"black"===t?"white":"white"===t?"black":t}}class r{constructor(t){this.data=new Array(t);for(let e=0;e<this.data.length;e++)this.data[e]=new Array(t);for(let e=0;e<t;e++)for(let s=0;s<t;s++)this.data[e][s]=new h;this.n=t,this.whiteCount=0,this.blackCount=0;for(let t=1;t<=6;t++)this.setBlackAt(t,0),this.setBlackAt(t,7),this.setWhiteAt(0,t),this.setWhiteAt(7,t)}copy(){const t=r(this.n);for(let e=0;e<n;e++)for(let s=0;s<n;s++)t.data[e][s].setState(this.data[e][s].state);return t.n=Number(this.n),t.blackCount=Number(this.blackCount),t.whiteCount=Number(this.whiteCount),t}setBlackAt(t,e){if(this.data[t][e].isWhite())this.blackCount++,this.whiteCount--;else{if(!this.data[t][e].isNone())throw new Exception("ChessBoard::setBlackAt() Exception");this.blackCount++}this.data[t][e].setBlack()}setWhiteAt(t,e){if(this.data[t][e].isBlack())this.whiteCount++,this.blackCount--;else{if(!this.data[t][e].isNone())throw new Exception("ChessBoard::setWhiteAt() Exception");this.whiteCount++}this.data[t][e].setWhite()}setAt(t,e,s){"black"===s?this.setBlackAt(t,e):"white"===s&&this.setWhiteAt(t,e)}resetAt(t,e){this.data[t][e].clear()}moveFromTo(t,e,s,i){this.setAt(s,i,this.data[t][e]),this.resetAt(t,e)}getUpdownChessCountFrom(t,e){let s=0;for(let t=0;t<this.n;t++)this.data[t][e].isNone()||s++;return s}getLeftrightChessCountFrom(t,e){let s=0;for(let e=0;e<this.n;e++)this.data[t][e].isNone()||s++;return s}getDiagonalChessCountFrom(t,e){let s=0;for(;0!==t&&0!==e;)t--,e--;for(let i=0;t+i<this.n&&e+i<this.n;i++)this.data[t+i][e+i].isNone()||s++;return s}getCounterDiagonalChessCountFrom(t,e){let s=0;for(;t!==this.n-1&&0!==e;)t++,e--;for(;t>=0&&e<this.n;)this.data[t][e].isNone()||s++,t--,e++;return s}computeDestinationFrom(t,e,s,i,r){let n=!0,l=this.data[t][e].toString(),o=h.playerReverse(l);const a=Number(t),c=Number(e);for(let h=0;h<r-1;h++)if(e+=i,(t+=s)<0||t>=this.n||e<0||e>=this.n||this.data[t][e].toString()===o){n=!1;break}if(n&&(e+=i,((t+=s)<0||t>=this.n||e<0||e>=this.n||this.data[t][e].toString()===l)&&(n=!1)),n){let s=this.copy();return s.moveFromTo(a,c,t,e),{fromRow:a,fromCol:c,toRow:toRow,toCol:toCol,chessBoard:s}}return null}getAllNextStepAt(t,e){const s=new Array;if(!this.data[t][e].isNone()){let[i,h,r,n]=[this.getUpdownChessCountFrom(t,e),this.getLeftrightChessCountFrom(t,e),this.getDiagonalChessCountFrom(t,e),this.getCounterDiagonalChessCountFrom(t,e)],l=this.computeDestinationFrom(t,e,-1,0,i);null!==l&&s.push(l);let o=this.computeDestinationFrom(t,e,1,0,i);null!==o&&s.push(o);let a=this.computeDestinationFrom(t,e,0,-1,h);null!==a&&s.push(a);let c=this.computeDestinationFrom(t,e,0,1,h);null!==c&&s.push(c);let u=this.computeDestinationFrom(t,e,-1,-1,r);null!==u&&s.push(u);let d=this.computeDestinationFrom(t,e,1,1,r);null!==d&&s.push(d);let p=this.computeDestinationFrom(t,e,-1,1,n);null!==p&&s.push(p);let f=this.computeDestinationFrom(t,e,1,-1,n);null!==f&&s.push(f)}return s}getAllNextStep(t){const e=new Array;if("none"!==t)for(let s=0;s<this.n;s++)for(let i=0;i<this.n;i++)if(this.data[s][i].toString()===t){const t=this.getAllNextStepAt(s,i);e.push(...t)}return e}getRandomNextChessBoard(t){return ans=this.getAllNextStep(t),ans[Math.floor(Math.random()*ans.length)]}BFSHelper(t,e,s,i){return s>=0&&s<this.n&&i>=0&&i<this.n&&!e[s][i]?(e[s][i]=!0,t.push({row:s,col:i}),1):0}BFS(t,e){let s=0,i=[],h=new Array(this.n);for(let t=0;t<this.n;t++)h[t]=new Array(this.n),h[t].fill(!1,0,this.end);for(i.push({row:t,col:e}),h[t][e]=!0,s++;i.length;){const t=i.shift();let{topRow:e,topCol:r}=t;s+=this.BFSHelper(i,h,e-1,r),s+=this.BFSHelper(i,h,e+1,r),s+=this.BFSHelper(i,h,e,r-1),s+=this.BFSHelper(i,h,e,r+1),s+=this.BFSHelper(i,h,e-1,r-1),s+=this.BFSHelper(i,h,e+1,r+1),s+=this.BFSHelper(i,h,e-1,r+1),s+=this.BFSHelper(i,h,e+1,r-1)}return s}isConnect(t){let e=!1;if("none"!==t){let s=0;s="black"===t?this.blackCount:this.whiteCount;for(let i=0;i<this.n;i++)for(let h=0;h<this.n;h++)if(this.data[i][h].toString()===t){e=this.BFS(i,h)===s;break}}return e}isTerminal(t){let e="none";return bl=this.getAllNextStep("black").length,wl=this.getAllNextStep("white").length,this.isConnect("black")?e="black":this.isConnect("white")?e="white":0===this.getAllNextStep("black").length?e="white":0===bl?e=wl>0?"white":t:0===wl&&(e=bl>0?"black":lstStepPalyer),e}isGood(){return"none"}}var l=r,o=1.414;class a{constructor(t,e){this.chessBoard=t,this.player=e,this.visits=0,this.scores=0,this.uct=0}copy(){const t=new a(this.chessBoard.copy(),String(this.player));t.visits=Number(this.visits),t.scores=Number(this.scores),t.uct=Number(this.uct)}static playerReverse(t){return"white"===t?"black":"black"===t?"white":t}}class c{constructor(t,e){this.state=t,this.parent=e,this.children=new Array,this.bestChild=null,this.evaluatedChildren=new Set}copy(){const t=new c(this.state.copy(),this.parent);null===this.bestChild&&0===this.children.length||alert("shallow copy happened!");for(let e=0;e<this.children.length;e++)t.children.push(this.children[e]);t.bestChild=null!==this.bestChild?this.bestChild.copy():null;for(let e of this.evaluatedChildren)t.evaluatedChildren.add(e)}isExtended(){return this.children.length&&this.children.length===this.evaluatedChildren.size}addChild(t){this.children.push(t)}getChildren(){return this.children}getUCT(){if(null!==this.parent&&this.state.visits>0)return t=this.parent.state.visits,this.state.scores/this.state.visits+o*Math.sqrt(Math.log(t)/this.state.visits);throw new Exception("MCTNode::getUCT() Exception")}updateState(t,e){this.state.visits+=t,this.state.scores+=e,this.state.uct=this.getUCT()}}var u=class{constructor(t,e){let s=new a(t,e);this.root=new c(s,null),this.rootPlayer=e,this.winner=a.playerReverse(e),this.firstStepMap=new Array}extend(t){if(!t.children.length){curChessBoard=t.state.chessBoard,curPlayer=t.state.player,nextPlayer=a.playerReverse(curPlayer),nextSteps=curChessBoard.getAllNextStep(nextPlayer);for(let e of nextSteps){let{fromRow:s,fromCol:i,toRow:h,toCol:r,chessBoard:n}=e,l=new a(n,nextPlayer),o=new c(l,t);t.addChild(o),null===t.parent&&this.firstStepMap.push({fromRow:s,fromCol:i,toRow:h,toCol:r})}}let e=null;for(let s=0;s<t.children.length;s++)t.evaluatedChildren.has(s)||(t.evaluatedChildren.add(s),e=t.children[s]);return e}simulate(t){let e=t.state.player,s=this.winner,i=t.state.chessBoard;for(;"none"===i.isTerminal(e)&&(e=a.playerReverse(e),"none"===(i=i.getRandomNextChessBoard(e)).isTerminal(e));)e=a.playerReverse(e),i=i.getRandomNextChessBoard(e);return Number(i.isTerminal(e)===s)}search(){if("none"!==this.root.state.chessBoard.isTerminal(this.rootPlayer))return;for(cur=this.root,cur.state.visits++;cur.isExtended();)cur=cur.bestChild,cur.state.visits++;simulateBegin=this.extend(cur);let t=0,e=null;null===simulateBegin?(t=Number(cur.state.chessBoard.isTerminal(this.rootPlayer)===this.winner),e=cur):(t=this.simulate(simulateBegin.copy()),simulateBegin.state.visits+=1,e=simulateBegin);let s=e;for(;null!==s.parent;){s.updateState(0,t);let e=npCur.parent;for(let t of e.children){t!==s&&t.state.visits&&t.updateState(0,0);let i=t.state.uct;(null===e.bestChild||e.bestChild.state.uct<i)&&(e.bestChild=t)}beCur=e}}generate(){let t=new Date,e=t.getTime(),s=t.getTime();for(;Number(s-e)<=6e3;)this.search(),s=t.getTime();let i=this.root.children,h=i.reduce((t,e,s,i)=>e.state.visits>i[t].state.visits?s:t,0);return{chessBoard:i[h].state.chessBoard,firstStep:this.firstStepMap[h]}}};new class{constructor(t){this.canvasId=t,this.resetData()}resetData(){var t=document.documentElement||document.body,e=Math.min(t.clientWidth,t.clientHeight);this.chesses=null,this.rowCount=8,this.colCount=this.rowCount,this.cellWidth=e/this.rowCount,this.width=this.rowCount*this.cellWidth,this.height=this.width,this.R=.4*this.cellWidth,this.positive="black",this.canvas=document.getElementById(this.canvasId),this.ctx=this.canvas.getContext("2d"),this.chessBoard=new l(8),this.init()}init(){this.initCanvas(),this.renderUI()}initCanvas(){this.canvas.width=this.width,this.canvas.height=this.height,this.canvas.addEventListener("click",t=>{let e=this.canvas.getBoundingClientRect(),s=Math.floor((t.clientX-e.left)/this.cellWidth),i=Math.floor((t.clientY-e.top)/this.cellWidth);if(console.log(s,i,"click position(X, Y)"),!this.fromRow&&!this.fromCol)return this.fromRow=i,void(this.fromCol=s);this.fromRow=null,this.fromCol=null,this.chessBoard.moveFromTo(this.fromRow,this.fromCol,i,s),this.renderUI();let h=new u(this.chessBoard,this.positive);this.positive=function(t){return"black"===t?"white":"white"===t?"black":null}(this.positive);let{chessBoard:r,firstStep:n}=h.generate();this.chessBoard=r,this.renderUI()},!1)}renderUI(){this.ctx.clearRect(0,0,this.width,this.height),this.drawMap(),this.drawChesses(this.chessBoard)}drawDot(t,e,s,i){let h=e*this.cellWidth+this.cellWidth/2,r=t*this.cellWidth+this.cellWidth/2;this.ctx.beginPath(),this.ctx.arc(h,r,s,0,2*Math.PI),this.ctx.closePath(),this.ctx.fillStyle=i,this.ctx.fill()}drawMap(){this.ctx.beginPath(),this.ctx.rect(0,0,this.width,this.height),this.ctx.closePath(),this.ctx.fillStyle="#ffa5e8",this.ctx.fill(),this.ctx.beginPath();for(let t=0;t<this.rowCount;t++)this.ctx.moveTo(0,this.cellWidth*t),this.ctx.lineTo(this.cellWidth*this.rowCount,this.cellWidth*t);this.ctx.stroke(),this.ctx.beginPath();for(let t=0;t<this.colCount;t++)this.ctx.moveTo(this.cellWidth*t,0),this.ctx.lineTo(this.cellWidth*t,this.cellWidth*this.colCount);this.ctx.stroke()}drawChesses(t){this.chesses=t.data;for(let t=0;t<this.chesses.length;t++)for(let e=0;e<this.chesses[t].length;e++)"string"==typeof this.chesses[t][e]&&(this.chesses[t][e]=JSON.parse(this.chesses[t][e])),"black"===this.chesses[t][e].state?this.drawDot(t,e,this.R,"black"):"white"===this.chesses[t][e].state&&this.drawDot(t,e,this.R,"white")}}("blackWhite")}]);