!function(t){var e={};function s(i){if(e[i])return e[i].exports;var h=e[i]={i:i,l:!1,exports:{}};return t[i].call(h.exports,h,h.exports,s),h.l=!0,h.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var h in t)s.d(i,h,function(e){return t[e]}.bind(null,h));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=2)}([function(t,e){},function(t,e){},function(t,e,s){"use strict";s.r(e);var i=s(0),h=s.n(i),o=s(1),l=s.n(o);new class{constructor(t){this.canvasId=t,this.resetData()}resetData(){var t=document.documentElement||document.body,e=Math.min(t.clientWidth,t.clientHeight);this.chesses=null,this.rowCount=8,this.colCount=this.rowCount,this.cellWidth=e/this.rowCount,this.width=this.rowCount*this.cellWidth,this.height=this.width,this.R=.4*this.cellWidth,this.positive="black",this.canvas=document.getElementById(this.canvasId),this.ctx=this.canvas.getContext("2d"),this.chessBoard=new h.a(8),this.init()}init(){this.initCanvas(),this.renderUI()}initCanvas(){this.canvas.width=this.width,this.canvas.height=this.height,this.canvas.addEventListener("click",t=>{let e=this.canvas.getBoundingClientRect(),s=Math.floor((t.clientX-e.left)/this.cellWidth),i=Math.floor((t.clientY-e.top)/this.cellWidth);if(this.fromRow||this.fromCol)if(this.fromRow===i&&this.fromCol===s)this.fromRow=null,this.fromCol=null,this.renderUI();else if(this.chessBoard.data[i][s].state===this.positive){this.renderUI(),this.fromRow=i,this.fromCol=s,this.allNextStep=this.chessBoard.getAllNextStepAt(i,s);for(let t of this.allNextStep){let{fromRow:e,fromCol:s,toRow:i,toCol:h,chessBoard:o}=t;this.drawNextPosition(i,h)}}else if(this.validateStep(i,s)){this.chessBoard.moveFromTo(this.fromRow,this.fromCol,i,s),this.renderUI(),console.log("winner:",this.chessBoard.isTerminal(this.positive)),this.fromRow=null,this.fromCol=null;let t=this.chessBoard.isTerminal(this.positive);if("none"!==t)return void window.setTimeout(()=>{alert("游戏结束, "+t+"胜"),this.chessBoard=new h.a(8),this.renderUI()},1);window.setTimeout(()=>{let e=new l.a(this.chessBoard,this.positive),{chessBoard:s,firstStep:i,duration:o}=e.generate();this.chessBoard=s,this.renderUI(),this.drawLastPosition(i.fromRow,i.fromCol),document.getElementById("textDiv").innerHTML=o+"ms","none"===(t=this.chessBoard.isTerminal(this.positive))||window.setTimeout(()=>{alert("游戏结束, "+t+"胜"),this.chessBoard=new h.a(8),this.renderUI()},1)},1),console.log("after AI winner:",this.chessBoard.isTerminal(this.positive)),console.log("black CC:",this.chessBoard.getCC("black")),console.log("white CC:",this.chessBoard.getCC("white")),console.log("black count:",this.chessBoard.blackCount),console.log("white count:",this.chessBoard.whiteCount)}else alert("落子错误");else if(this.chessBoard.data[i][s].state===this.positive){this.renderUI(),this.fromRow=i,this.fromCol=s,this.allNextStep=this.chessBoard.getAllNextStepAt(i,s);for(let t of this.allNextStep){let{fromRow:e,fromCol:s,toRow:i,toCol:h,chessBoard:o}=t;this.drawNextPosition(i,h)}}},!1)}renderUI(){return this.ctx.clearRect(0,0,this.width,this.height),this.drawMap(),this.drawChesses(this.chessBoard),!0}drawDot(t,e,s,i){let h=e*this.cellWidth+this.cellWidth/2,o=t*this.cellWidth+this.cellWidth/2;this.ctx.beginPath(),this.ctx.arc(h,o,s,0,2*Math.PI),this.ctx.closePath(),this.ctx.fillStyle=i,this.ctx.fill()}drawMap(){this.ctx.beginPath(),this.ctx.rect(0,0,this.width,this.height),this.ctx.closePath(),this.ctx.fillStyle="#f4a460",this.ctx.fill(),this.ctx.beginPath();for(let t=0;t<this.rowCount;t++)this.ctx.moveTo(0,this.cellWidth*t),this.ctx.lineTo(this.cellWidth*this.rowCount,this.cellWidth*t);this.ctx.strokeStyle="blue",this.ctx.stroke(),this.ctx.beginPath();for(let t=0;t<this.colCount;t++)this.ctx.moveTo(this.cellWidth*t,0),this.ctx.lineTo(this.cellWidth*t,this.cellWidth*this.colCount);this.ctx.strokeStyle="blue",this.ctx.stroke()}drawChesses(t){this.chesses=t.data;for(let t=0;t<this.chesses.length;t++)for(let e=0;e<this.chesses[t].length;e++)"string"==typeof this.chesses[t][e]&&(this.chesses[t][e]=JSON.parse(this.chesses[t][e])),"black"===this.chesses[t][e].state?this.drawDot(t,e,this.R,"black"):"white"===this.chesses[t][e].state&&this.drawDot(t,e,this.R,"white")}drawNextPosition(t,e){let s=e*this.cellWidth+this.cellWidth/2,i=t*this.cellWidth+this.cellWidth/2;this.ctx.beginPath(),this.ctx.arc(s,i,this.R,0,2*Math.PI),this.ctx.closePath(),this.ctx.strokeStyle="green",this.ctx.stroke()}drawLastPosition(t,e){let s=e*this.cellWidth+this.cellWidth/2,i=t*this.cellWidth+this.cellWidth/2;this.ctx.beginPath(),this.ctx.arc(s,i,this.R,0,2*Math.PI),this.ctx.closePath(),this.ctx.strokeStyle="red",this.ctx.stroke()}validateStep(t,e){let s=!1;for(let i of this.allNextStep){let{fromRow:h,fromCol:o,toRow:l,toCol:r,chessBoard:n}=i;if(l===t&&r===e){s=!0;break}}return s}}("blackWhite")}]);